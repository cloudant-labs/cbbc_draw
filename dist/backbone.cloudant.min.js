Backbone.Cloudant=_.clone(Backbone.Events),_.extend(Backbone.Cloudant,{VERSION:"0.0.1",database:"http://username.cloudant.com/mydb",auth:{},watch:function(e){this.on("change:cloudant_change",function(t){e.handleChange(t)})},changeHandler:function(e){function n(){t.changeHandler(e)}var t=this;e=e||0,$.getJSON(t.database+"/_changes",{since:e,feed:"longpoll"}).success(function(r){e!==r.last_seq&&(e=r.last_seq,t.trigger("change:cloudant_change",r.results)),n()}).error(function(e){setTimeout(n,5e3)})}}),Backbone.Cloudant.Model=Backbone.Model.extend({idAttribute:"_id",url:function(){var e=Backbone.Cloudant.database;return typeof this.id!="undefined"&&(e+="/"+this.id),e},parse:function(e){return e.rev&&(e._rev=e.rev,delete e.rev),e.id&&(typeof this.id=="undefined"&&(e._id=e.id),delete e.id),e.ok&&delete e.ok,e}}),Backbone.Cloudant.Collection=Backbone.Collection.extend({model:Backbone.Cloudant.Model,cloudant_options:{},totalLength:0,initialize:function(e){e&&e.watch&&(Backbone.Cloudant.watch(this),delete e.watch)},parse:function(e){return e.total_rows?this.totalLength=e.total_rows:this.totalLength=e.rows.length,e.rows},fetchMore:function(){this.cloudant_options.limit&&(this.cloudant_options.skip?this.cloudant_options.skip+=this.cloudant_options.limit:this.cloudant_options.skip=this.cloudant_options.limit,this.fetch({add:!0}))},baseURL:function(){return Backbone.Cloudant.database},url:function(){var e=$.param(this.cloudant_options),t=this.baseURL();return e&&(t=t+"?"+e),t},handleChange:function(e){this.fetch()}}),Backbone.Cloudant.Docs={Collection:Backbone.Cloudant.Collection.extend({baseURL:function(){return[Backbone.Cloudant.database,"_all_docs"].join("/")}})},Backbone.Cloudant.Search={Collection:Backbone.Cloudant.Collection.extend({design:"my_design",index:"my_index",parse:function(e){return this.cloudant_options.bookmark=e.bookmark,e.total_rows?this.totalLength=e.total_rows:this.totalLength=e.rows.length,e.rows},baseURL:function(){return[Backbone.Cloudant.database,"_design",this.design,"_search",this.index].join("/")},fetchMore:function(){this.fetch({add:!0})}})},Backbone.Cloudant.View={Collection:Backbone.Cloudant.Collection.extend({design:"my_design",view:"my_view",baseURL:function(){return[Backbone.Cloudant.database,"_design",this.design,"_view",this.view].join("/")}})};